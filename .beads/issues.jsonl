{"id":"clipboard-0nf","title":"ClipStack v1.1 Upgrade - Comprehensive Enhancement Suite","status":"open","priority":1,"issue_type":"epic","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:27:55.937476986-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:27:55.937476986-05:00","comments":[{"id":1,"issue_id":"clipboard-0nf","author":"solsystemlabs","text":"# ClipStack v1.1 Upgrade Epic - Full Documentation\n\n## Executive Overview\n\nThis epic encompasses five strategically-selected improvements to transform ClipStack from a functional clipboard manager into a robust, user-friendly tool that competes with established alternatives. Each improvement addresses a real user need or reliability concern while remaining pragmatic and well-scoped.\n\n## Rationale \u0026 Business Value\n\nClipStack's core value proposition is \"never lose clipboard history\" - yet several gaps undermine this promise:\n\n1. **Usability Gap**: Search only matches 100-char previews, missing content buried deeper\n2. **Feature Gap**: No way to protect important entries from automatic pruning\n3. **Reliability Gap**: Non-atomic writes risk data corruption on interruption\n4. **UX Gap**: Cannot scroll preview content without pasting first\n5. **Flexibility Gap**: Hardcoded 100-entry limit doesn't suit all users\n\n## Design Principles (MUST be followed)\n\n1. **Backwards Compatibility**: Existing storage format remains readable; new fields use `#[serde(default)]`\n2. **Progressive Enhancement**: New features don't change existing workflows unless user opts in\n3. **Minimal Dependencies**: No new crate dependencies unless absolutely necessary\n4. **Test-Driven Development**: Each improvement includes comprehensive tests BEFORE implementation\n\n## Implementation Phases\n\n### Phase 1: Foundation (MUST complete first)\n- Improvement #5: Configurable Max Entries - Changes Storage::new() signature that everything depends on\n- Improvement #3: Atomic File Writes - Adds reliability foundation before other changes\n\n### Phase 2: Storage Features\n- Improvement #2: Pinned/Favorites - Adds pinned field to ClipEntry, modifies pruning logic\n\n### Phase 3: Picker Features\n- Improvement #1: Full Content Search - Major picker refactor (FilteredEntry type)\n- Improvement #4: Preview Scrolling - Adds focus mode and scroll state\n\n## Critical Success Metrics\n\n- All existing tests continue to pass\n- No clippy warnings\n- Release build compiles successfully\n- Performance remains acceptable (\u003c500ms search for 100 entries)\n- Upgrade from old storage format works seamlessly\n\n## Key Files Affected\n\n| File | Scope of Changes |\n|------|------------------|\n| src/storage.rs | pinned field, max_entries param, atomic_write(), toggle_pin(), recovery |\n| src/picker.rs | FilteredEntry, MatchLocation, Focus, preview scroll, focus mode, pin toggle |\n| src/main.rs | --max-entries flag, Recover command, daemon/stats/status updates |\n| src/daemon.rs | new() signature update for max_entries |\n\n## Estimated Total Lines Changed: 800-1000\n\n## References\n\n- docs/IMPLEMENTATION_SPEC.md - Complete, copy-paste-ready code for all features\n- docs/UPGRADE_PLAN.md - Strategic rationale and design decisions\n- AGENTS.md - Workflow instructions and session protocols\n","created_at":"2026-01-13T17:28:36Z"}]}
{"id":"clipboard-0nf.1","title":"Integration test: All v1.1 features work together","description":"Create comprehensive integration test (tests/integration/test_v11_features.sh) that verifies all v1.1 features work correctly together. Tests:\n\nCROSS-FEATURE SCENARIOS:\n1. Configurable limits + Pinned entries\n   - Set max_entries=20, pin 5 entries, add 25 more\n   - Verify: 25 total (5 pinned + 20 unpinned), oldest unpinned pruned\n   \n2. Full content search + Pinned entries\n   - Pin entry with deep content match, search for it\n   - Verify: Found with ★ indicator AND [+] content match indicator\n   \n3. Preview scrolling + Long pinned entries\n   - Pin entry with 500 lines, scroll to line 200\n   - Verify: Scroll works, ★ indicator persists\n   \n4. Atomic writes + Pin toggle\n   - Toggle pin during simulated crash (kill -9 during write)\n   - Verify: Either old or new state (no corruption)\n   \n5. Recovery + Pinned entries\n   - Corrupt index with pinned entries, run recover\n   - Verify: Recovered entries have pinned=false (expected)\n   \n6. All features respect max_entries configuration\n   - Test with CLI flag, env var, and default\n   - Verify: All features obey configured limit\n\nLOGGING: Same format as E2E tests (colored, numbered, summary)\nCLEANUP: Temp data dir per test\nEXIT: 0 if all pass, 1 if any fail","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T13:30:27.23528175-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T14:07:45.451901993-05:00","dependencies":[{"issue_id":"clipboard-0nf.1","depends_on_id":"clipboard-0nf","type":"parent-child","created_at":"2026-01-13T13:30:27.237288834-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-0nf.1","depends_on_id":"clipboard-tsd.15","type":"blocks","created_at":"2026-01-13T13:30:34.676200616-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-0nf.1","depends_on_id":"clipboard-8u5.11","type":"blocks","created_at":"2026-01-13T13:30:35.054298974-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-0nf.1","depends_on_id":"clipboard-b6y.20","type":"blocks","created_at":"2026-01-13T13:30:35.410364139-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-0nf.1","depends_on_id":"clipboard-2wl.15","type":"blocks","created_at":"2026-01-13T13:30:35.782404535-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-0nf.1","depends_on_id":"clipboard-pve.18","type":"blocks","created_at":"2026-01-13T13:30:36.145829236-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-0nf.2","title":"Integration test: Daemon + Picker + Storage interaction","description":"Create integration test (tests/integration/test_component_interaction.sh) verifying daemon+picker+storage component interaction. Tests:\n\nCOMPONENT BOUNDARY SCENARIOS:\n1. Daemon saves → Picker sees immediately\n   - Start daemon, copy text via wl-copy\n   - Open picker within 500ms, verify entry visible\n   \n2. Picker changes → Daemon respects\n   - Open picker, delete entry, close picker\n   - Daemon next poll should see deletion (verify file removed)\n   \n3. Atomic writes during concurrent access\n   - Start daemon, open picker\n   - Rapidly copy 100 items while navigating picker\n   - Verify: No corruption, no .tmp files remaining\n   \n4. Lock file prevents multiple daemons\n   - Start daemon, try to start second\n   - Verify: Second exits with \"already running\" message\n   \n5. Graceful handling when daemon stops\n   - Open picker, stop daemon (kill -TERM)\n   - Navigate in picker (should work, just no new entries)\n   - Copy action should succeed (calls wl-copy directly)\n\nRACE CONDITION TESTS:\n6. Simultaneous pin toggle from two processes\n   - Use flock or similar to test contention\n   - Verify: No corruption, one wins\n\nLOGGING: Same format as E2E tests\nCLEANUP: Temp data dir, kill any stray daemon processes\nEXIT: 0 if all pass, 1 if any fail","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T13:30:27.608504769-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T14:09:54.411050415-05:00","dependencies":[{"issue_id":"clipboard-0nf.2","depends_on_id":"clipboard-0nf","type":"parent-child","created_at":"2026-01-13T13:30:27.610420482-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-0nf.2","depends_on_id":"clipboard-8u5","type":"blocks","created_at":"2026-01-13T14:01:13.313961839-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-1m3","title":"ClipStack v2.0 Upgrade: 5 Strategic Improvements","description":"# ClipStack v2.0 Upgrade Epic\n\n## Overview\nThis epic encompasses a comprehensive upgrade to ClipStack, transforming it from a functional \nclipboard manager into a polished, feature-rich tool. The upgrade consists of 5 strategic \nimprovements that address real user pain points identified through usage analysis.\n\n## Strategic Goals\n1. **Data Safety**: Prevent data loss from interrupted writes or corruption\n2. **Content Discovery**: Find clipboard entries even when content is buried deep\n3. **Persistence Control**: Protect important entries from automatic pruning\n4. **Content Inspection**: View large clipboard entries without leaving the picker\n5. **Flexibility**: Accommodate different user workflows with configurable limits\n\n## Implementation Philosophy\n- TDD methodology: Tests FIRST, then implementation\n- Atomic commits: One improvement per commit for clean history\n- Backwards compatibility: Old storage formats must continue to work\n- Minimal dependencies: Reuse existing patterns where possible\n\n## Phase Structure\nThe improvements are organized into 3 phases based on dependencies:\n\n### Phase 1: Foundation (MUST be done first)\n- Feature 5: Configurable Max Entries - Changes Storage::new() signature\n- Feature 3: Atomic File Writes - Adds data safety layer\n\n### Phase 2: Storage Features\n- Feature 2: Pinned/Favorites - Depends on new Storage API\n\n### Phase 3: Picker Features  \n- Feature 1: Full Content Search - Major picker refactor\n- Feature 4: Preview Scrolling - Builds on picker changes\n\n## Success Criteria\n- All existing tests continue to pass\n- No clippy warnings\n- Manual integration testing passes all checkpoints\n- Upgrade from old storage format works seamlessly\n- All 5 features work together without conflicts\n\n## Risk Mitigation\n- Phase 1 provides atomic writes BEFORE adding complex features\n- Each feature is independently testable\n- Recovery command provides escape hatch for corruption\n\n## Reference Documents\n- docs/IMPLEMENTATION_SPEC.md - Complete code specifications\n- docs/UPGRADE_PLAN.md - Original analysis and selection rationale","status":"tombstone","priority":1,"issue_type":"epic","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:15:54.788218874-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:18:35.332419764-05:00","deleted_at":"2026-01-13T12:18:35.332419764-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"clipboard-2wl","title":"Improvement #1: Full Content Search","description":"HIGHEST IMPACT improvement. Currently search only matches 100-char preview, missing content buried deeper. User copies 500-line file, searches for function name on line 247 - search finds nothing! This undermines core value prop. Solution: two-phase search - Phase 1 searches previews (fast), Phase 2 loads and searches full content for non-matches. Visual indicator [+] shows content-only matches.","status":"open","priority":1,"issue_type":"feature","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:35:25.658108397-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:35:25.658108397-05:00","dependencies":[{"issue_id":"clipboard-2wl","depends_on_id":"clipboard-0nf","type":"parent-child","created_at":"2026-01-13T12:36:36.790625926-05:00","created_by":"solsystemlabs"}],"comments":[{"id":5,"issue_id":"clipboard-2wl","author":"solsystemlabs","text":"# Improvement #1: Full Content Search - Detailed Documentation\n\n## Problem Statement - HIGHEST IMPACT FIX\n\nCurrently, ClipStack's fuzzy search only matches against the 100-character preview stored in `index.json`. This creates a CRITICAL usability gap:\n\n```\nUser copies a 500-line code file\nUser wants to find it by searching for \"handleAuthentication\"\nThat function name appears on line 247\nSearch finds nothing because preview only contains lines 1-3\nUser cannot find their content\n```\n\nThis limitation undermines THE CORE VALUE PROPOSITION of a clipboard history manager: **finding content you copied in the past**.\n\n## Current Broken Behavior\n\n```rust\n// picker.rs - BUG: Only searches preview, not full content\nfn update_filter(\u0026mut self) {\n    // ...\n    self.matcher.fuzzy_match(\u0026entry.preview, \u0026self.search_query)\n    // ^ PROBLEM: preview is only first 100 chars!\n}\n```\n\n## Solution Design: Two-Phase Search\n\n### Phase 1 (Fast): Search previews first\n- Already in memory, no I/O\n- Most searches find matches here\n- Returns immediately with results\n\n### Phase 2 (Thorough): For non-matches, load full content\n- Only triggered when preview search fails\n- Loads content files from disk\n- Enforces limits to prevent expensive I/O\n\nThis approach balances performance with completeness.\n\n## Implementation Requirements\n\n### New Types\n\n```rust\n/// Tracks whether a match was found in preview or full content\n#[derive(Clone, Copy, PartialEq)]\nenum MatchLocation {\n    Preview,\n    FullContent,\n}\n\n/// Replaces Vec\u003cusize\u003e - tracks index + match metadata\nstruct FilteredEntry {\n    index: usize,\n    score: i64,\n    match_location: MatchLocation,\n}\n```\n\n### Constants (Performance Limits)\n\n```rust\nconst MAX_CONTENT_SEARCHES: usize = 50;   // Max files to load\nconst MAX_CONTENT_MATCHES: usize = 10;    // Stop after 10 content matches\nconst MIN_QUERY_FOR_CONTENT_SEARCH: usize = 2;  // Need 2+ chars\n```\n\n### Design Decision: Score Penalty for Content Matches\n\nContent-only matches receive 80% of their raw score:\n```rust\nscore: score * 8 / 10,  // Slightly lower for content matches\n```\n\n**Rationale**: When a term appears in both preview and content, the preview match is more relevant (user saw it recently). Content matches are \"found by digging\" - useful but secondary.\n\n### Major Refactor: Picker::filtered Type Change\n\n**This is a BREAKING change within picker.rs.**\n\n```rust\n// OLD\nfiltered: Vec\u003cusize\u003e,\n\n// NEW\nfiltered: Vec\u003cFilteredEntry\u003e,\n```\n\nAll methods that access `self.filtered` must be updated:\n- `selected_entry()` - use `filtered[i].index`\n- `render_list()` - iterate FilteredEntry, show [+] indicator\n- `update_filter()` - return Vec\u003cFilteredEntry\u003e\n- `move_selection()` - no change (still uses filtered.len())\n\n### Visual Indicator for Content Matches\n\n```\n┌─History (2/847) matching 'handleAuth'─────────┐\n│\u003e 2h ago [  12KB] import { auth } from...      │ ← Preview match (normal)\n│  5d ago [  45KB] /** API routes */ ...    [+] │ ← Content match (indicator)\n└───────────────────────────────────────────────┘\n```\n\nThe `[+]` indicator (yellow color) shows this entry matched on full content, not preview.\n\n## Testing Requirements (TDD)\n\n1. `test_search_finds_preview_match()` - Basic preview match works\n2. `test_search_finds_content_match()` - Content beyond preview is found\n3. `test_preview_matches_rank_higher()` - Same term, preview \u003e content\n4. `test_search_performance_large_history()` - \u003c500ms with 100 entries\n5. `test_content_search_limits_respected()` - MAX_CONTENT_SEARCHES enforced\n\n## Performance Considerations\n\n1. **Lazy Loading**: Full content only loaded when preview search fails\n2. **Early Termination**: Stop after MAX_CONTENT_MATCHES content matches\n3. **Query Length Gate**: Only search content for queries ≥2 characters\n4. **Score Threshold**: Consider skipping content search if preview matches are strong\n\n## Edge Cases\n\n### Query Too Short\n- Single character queries don't trigger content search\n- Too many false positives from single chars\n\n### All Entries Already Match Preview\n- No content search needed\n- Phase 2 skipped entirely\n\n### Large Content Files\n- Content search reads full file\n- Consider adding size limit for content search (e.g., skip files \u003e1MB)\n\n## Success Criteria\n\n- [ ] Searches find content beyond the 100-char preview\n- [ ] Preview matches still rank higher than content-only matches\n- [ ] Visual indicator [+] distinguishes match location\n- [ ] Performance remains acceptable (\u003c500ms for 100 entries)\n- [ ] All existing tests pass\n- [ ] New tests cover edge cases\n\n## Files to Modify\n\n| File | Changes |\n|------|---------|\n| src/picker.rs | MatchLocation, FilteredEntry, two-phase search, [+] indicator, update all filtered accessors |\n\n## Dependencies\n\n- **Depends on**: Improvement #2 (for FilteredEntry to include pin status eventually)\n- **Note**: This can technically run in parallel with #4 but should be done first since it changes the filtered type significantly\n","created_at":"2026-01-13T17:36:36Z"}]}
{"id":"clipboard-2wl.1","title":"[#1] Define MatchLocation enum","description":"#[derive(Clone, Copy, PartialEq)] enum MatchLocation { Preview, FullContent }. Tracks whether search match was found in preview or full content. Used for visual indicator and score adjustment.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:37:05.877555637-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:37:05.877555637-05:00","dependencies":[{"issue_id":"clipboard-2wl.1","depends_on_id":"clipboard-2wl","type":"parent-child","created_at":"2026-01-13T12:37:05.879155929-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-2wl.10","title":"[#1] Write unit tests for preview matching","description":"test_search_finds_preview_match(): save entry with searchable preview, verify filtered contains match with MatchLocation::Preview.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:37:25.057011184-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:37:25.057011184-05:00","dependencies":[{"issue_id":"clipboard-2wl.10","depends_on_id":"clipboard-2wl","type":"parent-child","created_at":"2026-01-13T12:37:25.05874797-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-2wl.10","depends_on_id":"clipboard-2wl.4","type":"blocks","created_at":"2026-01-13T14:00:05.657797261-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-2wl.11","title":"[#1] Write unit tests for content matching","description":"test_search_finds_content_match(): save entry where searchable text is beyond 100-char preview (pad with 200+ chars first). Verify found with MatchLocation::FullContent.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:37:27.173519303-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:37:27.173519303-05:00","dependencies":[{"issue_id":"clipboard-2wl.11","depends_on_id":"clipboard-2wl","type":"parent-child","created_at":"2026-01-13T12:37:27.174964474-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-2wl.11","depends_on_id":"clipboard-2wl.6","type":"blocks","created_at":"2026-01-13T12:39:20.721638794-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-2wl.11","depends_on_id":"clipboard-2wl.4","type":"blocks","created_at":"2026-01-13T14:00:05.700893254-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-2wl.12","title":"[#1] Write unit tests for ranking (preview \u003e content)","description":"test_preview_matches_rank_higher(): create two entries with same search term, one in preview, one in content. Verify preview match sorts first due to score penalty.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:37:29.310849832-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:37:29.310849832-05:00","dependencies":[{"issue_id":"clipboard-2wl.12","depends_on_id":"clipboard-2wl","type":"parent-child","created_at":"2026-01-13T12:37:29.312919281-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-2wl.12","depends_on_id":"clipboard-2wl.6","type":"blocks","created_at":"2026-01-13T12:39:20.759249467-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-2wl.12","depends_on_id":"clipboard-2wl.4","type":"blocks","created_at":"2026-01-13T14:00:05.744102871-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-2wl.13","title":"[#1] Write performance tests for search","description":"test_search_performance_large_history(): create 100 entries, search for nonexistent term (triggers full content scan). Assert \u003c2 seconds. Verifies limits work.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:37:31.658256856-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:37:31.658256856-05:00","dependencies":[{"issue_id":"clipboard-2wl.13","depends_on_id":"clipboard-2wl","type":"parent-child","created_at":"2026-01-13T12:37:31.65990695-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-2wl.13","depends_on_id":"clipboard-2wl.3","type":"blocks","created_at":"2026-01-13T14:00:05.789160226-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-2wl.14","title":"[#1] Update selected_entry() for FilteredEntry type","description":"Change from self.entries[self.filtered[i]] to self.entries[self.filtered[i].index]. All index access needs this pattern.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:37:37.792769499-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:37:37.792769499-05:00","dependencies":[{"issue_id":"clipboard-2wl.14","depends_on_id":"clipboard-2wl","type":"parent-child","created_at":"2026-01-13T12:37:37.794261768-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-2wl.14","depends_on_id":"clipboard-2wl.4","type":"blocks","created_at":"2026-01-13T12:39:20.563263302-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-2wl.15","title":"[#1] Write E2E test script for full content search","description":"Create comprehensive E2E test script (tests/e2e/test_full_content_search.sh) that verifies two-phase search behavior via picker. Tests:\n1. Preview matches found quickly (phase 1) - search term in first 100 chars\n2. Content-only matches found (phase 2) - term buried at line 250 of large file\n3. Preview matches rank higher than content matches for same term\n4. [+] indicator shown for content-only matches in picker output\n5. Performance acceptable (\u003c500ms for 100 entries with full content scan)\n6. Content search limits enforced (MAX_CONTENT_SEARCHES=50, verify no more than 50 files read)\n\nLOGGING REQUIREMENTS:\n- Use colored output: GREEN=pass, RED=fail, YELLOW=info, CYAN=timing\n- Each test prints: [TEST N] Description... followed by result\n- For phase tests, show: \"Phase 1 matches: N, Phase 2 matches: M\"\n- For performance tests, show timing: \"Search completed in Xms (limit: 500ms)\"\n- Show match locations: \"Found at: preview|content\"\n- Print summary at end: \"X/Y tests passed\"\n- Exit code: 0 if all pass, 1 if any fail\n\nCLEANUP: Create temp CLIPSTACK_DATA_DIR per test, remove after each test\n\nExample output format:\n[TEST 2] Content-only match (buried deep)...\n  Creating entry with 500 lines, search term on line 250...\n  Running search for \"handleAuthentication\"...\n  Phase 1 matches: 0\n  Phase 2 matches: 1 (scanned 1 files)\n  Match location: content (expected: content)\n  ✓ PASS","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T13:29:59.750380222-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T14:03:22.401339329-05:00","dependencies":[{"issue_id":"clipboard-2wl.15","depends_on_id":"clipboard-2wl","type":"parent-child","created_at":"2026-01-13T13:29:59.75240013-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-2wl.15","depends_on_id":"clipboard-2wl.13","type":"blocks","created_at":"2026-01-13T13:30:10.218506195-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-2wl.2","title":"[#1] Define FilteredEntry struct","description":"struct FilteredEntry { index: usize, score: i64, match_location: MatchLocation }. Replaces Vec\u003cusize\u003e as Picker::filtered type. Carries match metadata for each filtered result.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:37:06.198122487-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:37:06.198122487-05:00","dependencies":[{"issue_id":"clipboard-2wl.2","depends_on_id":"clipboard-2wl","type":"parent-child","created_at":"2026-01-13T12:37:06.19973959-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-2wl.2","depends_on_id":"clipboard-2wl.1","type":"blocks","created_at":"2026-01-13T12:39:20.335372601-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-2wl.3","title":"[#1] Add search constants (MAX_CONTENT_SEARCHES, etc.)","description":"Add const MAX_CONTENT_SEARCHES: usize = 50 (max files to load), const MAX_CONTENT_MATCHES: usize = 10 (stop after 10), const MIN_QUERY_FOR_CONTENT_SEARCH: usize = 2 (need 2+ chars). Prevents unbounded disk I/O.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:37:07.525376751-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:37:07.525376751-05:00","dependencies":[{"issue_id":"clipboard-2wl.3","depends_on_id":"clipboard-2wl","type":"parent-child","created_at":"2026-01-13T12:37:07.531120759-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-2wl.4","title":"[#1] Change Picker::filtered type to Vec\u003cFilteredEntry\u003e","description":"BREAKING CHANGE: Change field type from Vec\u003cusize\u003e to Vec\u003cFilteredEntry\u003e. This affects ALL code that accesses self.filtered. Must update update_filter(), render_list(), selected_entry(), etc.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:37:09.69017291-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:37:09.69017291-05:00","dependencies":[{"issue_id":"clipboard-2wl.4","depends_on_id":"clipboard-2wl","type":"parent-child","created_at":"2026-01-13T12:37:09.691861156-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-2wl.4","depends_on_id":"clipboard-2wl.2","type":"blocks","created_at":"2026-01-13T12:39:20.374732925-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-2wl.5","title":"[#1] Implement Phase 1 search (preview matching)","description":"In update_filter(): iterate entries, fuzzy_match against preview. Build Vec\u003cFilteredEntry\u003e with MatchLocation::Preview. Collect unmatched indices for Phase 2. This is the fast path - in-memory only.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:37:11.934140332-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:37:11.934140332-05:00","dependencies":[{"issue_id":"clipboard-2wl.5","depends_on_id":"clipboard-2wl","type":"parent-child","created_at":"2026-01-13T12:37:11.936135752-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-2wl.5","depends_on_id":"clipboard-2wl.4","type":"blocks","created_at":"2026-01-13T12:39:20.411829497-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-2wl.5","depends_on_id":"clipboard-2wl.3","type":"blocks","created_at":"2026-01-13T12:39:20.450133727-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-2wl.6","title":"[#1] Implement Phase 2 search (content matching with limits)","description":"For unmatched entries from Phase 1: load full content from storage, fuzzy_match. Enforce limits: stop after MAX_CONTENT_MATCHES found, max MAX_CONTENT_SEARCHES file loads. Apply 80% score penalty. Only if query \u003e= MIN_QUERY_FOR_CONTENT_SEARCH chars.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:37:14.26276287-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:37:14.26276287-05:00","dependencies":[{"issue_id":"clipboard-2wl.6","depends_on_id":"clipboard-2wl","type":"parent-child","created_at":"2026-01-13T12:37:14.266864737-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-2wl.6","depends_on_id":"clipboard-2wl.5","type":"blocks","created_at":"2026-01-13T12:39:20.487118219-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-2wl.6","depends_on_id":"clipboard-2wl.3","type":"blocks","created_at":"2026-01-13T14:00:08.293338302-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-2wl.7","title":"[#1] Add selected_filtered() helper method","description":"Add method returning Option\u003c\u0026FilteredEntry\u003e for current selection. Provides access to match_location for UI decisions. Cleaner than repeatedly indexing into filtered.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:37:18.464686734-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:37:18.464686734-05:00","dependencies":[{"issue_id":"clipboard-2wl.7","depends_on_id":"clipboard-2wl","type":"parent-child","created_at":"2026-01-13T12:37:18.466116587-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-2wl.7","depends_on_id":"clipboard-2wl.4","type":"blocks","created_at":"2026-01-13T12:39:20.524666355-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-2wl.8","title":"[#1] Update render_list() for [+] content match indicator","description":"In render_list(): check filtered.match_location. If FullContent, append Span::styled(' [+]', Color::Yellow). Shows user that match was found in content, not preview.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:37:20.597689405-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:37:20.597689405-05:00","dependencies":[{"issue_id":"clipboard-2wl.8","depends_on_id":"clipboard-2wl","type":"parent-child","created_at":"2026-01-13T12:37:20.599428807-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-2wl.8","depends_on_id":"clipboard-2wl.4","type":"blocks","created_at":"2026-01-13T12:39:20.60089811-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-2wl.9","title":"[#1] Update all methods accessing self.filtered","description":"Audit all self.filtered usages: update_filter(), move_selection(), render_list(), delete_selected(), etc. Each must use .index to get entry index. Comprehensive refactor required.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:37:22.719911582-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:37:22.719911582-05:00","dependencies":[{"issue_id":"clipboard-2wl.9","depends_on_id":"clipboard-2wl","type":"parent-child","created_at":"2026-01-13T12:37:22.722375788-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-2wl.9","depends_on_id":"clipboard-2wl.4","type":"blocks","created_at":"2026-01-13T12:39:20.642987886-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-8u5","title":"Improvement #3: Atomic File Writes","description":"CRITICAL reliability fix - current fs::write() is NOT atomic. If interrupted mid-write (Ctrl+C, crash, power loss), files can be corrupted: truncated JSON, partial data, or empty files. This violates ClipStack's core promise of 'never lose clipboard history'. Solution: implement write-to-temp-then-rename pattern with fsync. The rename() syscall is atomic on POSIX filesystems. Also adds cleanup of orphaned temp files on startup and a recovery command for corrupted storage.","status":"open","priority":1,"issue_type":"feature","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:28:52.871570748-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:28:52.871570748-05:00","dependencies":[{"issue_id":"clipboard-8u5","depends_on_id":"clipboard-0nf","type":"parent-child","created_at":"2026-01-13T12:30:09.313812816-05:00","created_by":"solsystemlabs"}],"comments":[{"id":3,"issue_id":"clipboard-8u5","author":"solsystemlabs","text":"# Improvement #3: Atomic File Writes - Detailed Documentation\n\n## Problem Statement\n\nThe current storage implementation uses non-atomic writes:\n\n```rust\n// storage.rs:76\nfs::write(\u0026path, data).with_context(|| format!(\"Failed to write index: {:?}\", path))\n```\n\nThis is dangerous because `fs::write()` is NOT atomic. If the process is interrupted mid-write:\n\n```\nProcess: fs::write(\"index.json\", data)\n           |\n           |-- 1. Open/create file (truncates existing)\n           |-- 2. Write chunk 1\n           |-- 3. Write chunk 2  \u003c-- CRASH HERE\n           |-- 4. Write chunk 3\n           |-- 5. Close file\n\nResult: index.json contains only chunks 1-2, is invalid JSON\n```\n\nPossible corruption modes:\n- Truncated JSON (parse error on next load)\n- Partially written data (invalid content)\n- Empty file (complete data loss)\n\nFor a tool whose value is \"never lose clipboard history,\" this is an unacceptable reliability gap.\n\n## Solution: Write-and-Rename Pattern\n\nThe atomic pattern guarantees safety:\n\n```\nProcess: atomic_write(\"index.json\", data)\n           |\n           |-- 1. Write to index.json.tmp\n           |-- 2. fsync() temp file (ensure on disk)\n           |-- 3. rename(tmp, final)  \u003c-- ATOMIC\n\nIf crash during steps 1-2: temp file is corrupt, final file untouched\nIf crash during step 3: rename either happens or doesn't (atomic)\n```\n\nThe `rename()` syscall is atomic on POSIX filesystems (ext4, btrfs, APFS, HFS+).\n\n## Implementation Requirements\n\n### 1. atomic_write() Helper Method\n```rust\nfn atomic_write(\u0026self, path: \u0026Path, data: \u0026[u8]) -\u003e Result\u003c()\u003e {\n    let tmp_path = path.with_extension(\"tmp\");\n\n    // Step 1: Write to temp\n    let mut file = fs::File::create(\u0026tmp_path)?;\n    file.write_all(data)?;\n\n    // Step 2: Sync to disk\n    file.sync_all()?;\n    drop(file);  // Close before rename\n\n    // Step 3: Atomic rename\n    fs::rename(\u0026tmp_path, path)?;\n\n    // Step 4: Sync parent directory (full durability)\n    if let Some(parent) = path.parent() {\n        if let Ok(dir) = fs::File::open(parent) {\n            let _ = dir.sync_all();\n        }\n    }\n\n    Ok(())\n}\n```\n\n### 2. Cleanup Orphaned Temp Files\nOn startup, clean up any `.tmp` files left from interrupted operations:\n```rust\nfn cleanup_temp_files(\u0026self) -\u003e Result\u003c()\u003e {\n    for entry in fs::read_dir(\u0026self.base_dir)? {\n        let path = entry?.path();\n        if path.extension() == Some(\"tmp\".as_ref()) {\n            eprintln!(\"Cleaning up orphaned temp file: {:?}\", path);\n            let _ = fs::remove_file(\u0026path);\n        }\n    }\n    Ok(())\n}\n```\n\n### 3. Recovery Command\nFor cases where corruption occurs (from bugs in older versions):\n```rust\npub fn attempt_recovery(\u0026self) -\u003e Result\u003cusize\u003e {\n    // 1. Try to parse existing index\n    // 2. If fails, scan .txt content files\n    // 3. Rebuild index from content files\n    // 4. Deduplicate by hash\n    // 5. Save recovered index\n}\n```\n\n### 4. Update All Write Operations\n- `save_index()` → use atomic_write()\n- `save_entry()` content files → use atomic_write()\n\n## Testing Requirements (TDD)\n\n1. `test_atomic_write_creates_file()` - Basic write works\n2. `test_atomic_write_no_temp_file_remains()` - No .tmp left after success\n3. `test_cleanup_orphaned_temp_files()` - Startup cleans old .tmp\n4. `test_atomic_write_overwrites_existing()` - Overwrite works correctly\n5. `test_recovery_from_missing_index()` - Can rebuild from content files\n6. `test_concurrent_writes_safe()` - Multiple threads don't corrupt\n\n## Platform Considerations\n\n- **Linux/macOS**: `rename()` is atomic on ext4, btrfs, APFS, HFS+\n- **Windows**: `rename()` is atomic on NTFS (Rust handles MoveFileEx)\n- **Network filesystems**: NFS v3 has non-atomic rename; v4 is atomic\n  - Recommendation: Don't store clipboard data on network mounts\n\n## Success Criteria\n\n- [ ] All writes use atomic pattern\n- [ ] Orphaned temp files cleaned up on startup\n- [ ] Recovery command can rebuild index from content files\n- [ ] No data loss possible from interrupted writes\n- [ ] Concurrent access doesn't corrupt storage\n\n## Files to Modify\n\n| File | Changes |\n|------|---------|\n| src/storage.rs | Add atomic_write(), cleanup_temp_files(), attempt_recovery(), update save_* methods |\n| src/main.rs | Add Recover command |\n\n## Dependencies\n\n- **Depends on**: Improvement #5 (for Storage::new signature)\n- **Blocked by**: Nothing after #5 is done\n","created_at":"2026-01-13T17:29:41Z"}]}
{"id":"clipboard-8u5.1","title":"[#3] Implement atomic_write() helper method","description":"Add fn atomic_write(\u0026self, path: \u0026Path, data: \u0026[u8]) -\u003e Result\u003c()\u003e to Storage. Pattern: 1) Write to .tmp file 2) fsync() temp 3) rename to final 4) fsync parent dir. This is the core reliability primitive that eliminates data corruption risk.","status":"open","priority":1,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:31:40.282981883-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:31:40.282981883-05:00","dependencies":[{"issue_id":"clipboard-8u5.1","depends_on_id":"clipboard-8u5","type":"parent-child","created_at":"2026-01-13T12:31:40.284675067-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-8u5.10","title":"[#3] Write unit tests for recovery","description":"Write test_recovery_from_missing_index(): create content .txt files without index.json, call attempt_recovery(), verify index is rebuilt with correct entries. Also test_concurrent_writes_safe() for thread safety.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:31:49.484884347-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:31:49.484884347-05:00","dependencies":[{"issue_id":"clipboard-8u5.10","depends_on_id":"clipboard-8u5","type":"parent-child","created_at":"2026-01-13T12:31:49.486479037-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-8u5.10","depends_on_id":"clipboard-8u5.6","type":"blocks","created_at":"2026-01-13T12:32:01.940754023-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-8u5.11","title":"[#3] Write E2E test script for atomic file writes","description":"Create comprehensive E2E test script (tests/e2e/test_atomic_writes.sh) that verifies atomic file write reliability. Tests:\n1. Basic atomic write creates file correctly\n2. No .tmp files remain after successful operation\n3. Startup cleanup removes orphaned .tmp files (create fake .tmp, restart daemon)\n4. Atomic write overwrites existing file without corruption\n5. Recovery command rebuilds index from content files (corrupt index.json, run recover)\n6. Concurrent access safety (run daemon + picker simultaneously, verify no corruption)\n\nLOGGING REQUIREMENTS:\n- Use colored output: GREEN=pass, RED=fail, YELLOW=info\n- Each test prints: [TEST N] Description... followed by result\n- For file operations, show: \"Writing Xb to path...\" / \"File size: Xb\"\n- For cleanup tests, show: \"Found N .tmp files before, M after cleanup\"\n- For recovery, show: \"Recovered N/M entries\"\n- Print summary at end: \"X/Y tests passed\"\n- Exit code: 0 if all pass, 1 if any fail\n\nCLEANUP: Create temp data dir per test, remove after each test\n\nSAFETY: Recovery test must backup real data before corrupting test data\n\nExample output format:\n[TEST 5] Recovery from corrupted index...\n  Creating 5 test entries...\n  Corrupting index.json...\n  Running: clipstack recover\n  Recovered 5/5 entries\n  Verifying index integrity...\n  ✓ PASS","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T13:29:48.936137477-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T14:05:58.629815002-05:00","dependencies":[{"issue_id":"clipboard-8u5.11","depends_on_id":"clipboard-8u5","type":"parent-child","created_at":"2026-01-13T13:29:48.938131728-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-8u5.11","depends_on_id":"clipboard-8u5.10","type":"blocks","created_at":"2026-01-13T13:30:09.486484325-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-8u5.2","title":"[#3] Update save_index() to use atomic_write()","description":"Replace fs::write() call in save_index() with self.atomic_write(). The index.json file is critical - corruption here loses ALL metadata. Atomic writes ensure the index is always valid.","status":"open","priority":1,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:31:40.63430538-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:31:40.63430538-05:00","dependencies":[{"issue_id":"clipboard-8u5.2","depends_on_id":"clipboard-8u5","type":"parent-child","created_at":"2026-01-13T12:31:40.63575567-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-8u5.2","depends_on_id":"clipboard-8u5.1","type":"blocks","created_at":"2026-01-13T12:32:01.69190719-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-8u5.3","title":"[#3] Update save_entry() to use atomic_write() for content files","description":"Replace fs::write() in save_entry() for *.txt content files with atomic_write(). While content file corruption is less severe (only one entry lost), consistency requires atomic writes everywhere.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:31:40.960310136-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:31:40.960310136-05:00","dependencies":[{"issue_id":"clipboard-8u5.3","depends_on_id":"clipboard-8u5","type":"parent-child","created_at":"2026-01-13T12:31:40.961898684-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-8u5.3","depends_on_id":"clipboard-8u5.1","type":"blocks","created_at":"2026-01-13T12:32:01.726603576-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-8u5.4","title":"[#3] Implement cleanup_temp_files() method","description":"Add method to scan base_dir for *.tmp files and remove them. These are orphaned from interrupted operations. Log to stderr when cleaning: helps debugging but isn't an error condition.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:31:41.296286926-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:31:41.296286926-05:00","dependencies":[{"issue_id":"clipboard-8u5.4","depends_on_id":"clipboard-8u5","type":"parent-child","created_at":"2026-01-13T12:31:41.29778208-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-8u5.5","title":"[#3] Call cleanup_temp_files() in Storage::new()","description":"Add cleanup_temp_files()? call during Storage initialization, after create_dir_all but before returning Self. Ensures clean state on every startup.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:31:41.61389345-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:31:41.61389345-05:00","dependencies":[{"issue_id":"clipboard-8u5.5","depends_on_id":"clipboard-8u5","type":"parent-child","created_at":"2026-01-13T12:31:41.615438397-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-8u5.5","depends_on_id":"clipboard-8u5.4","type":"blocks","created_at":"2026-01-13T12:32:01.760286889-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-8u5.6","title":"[#3] Implement attempt_recovery() method","description":"Add pub fn attempt_recovery(\u0026self) -\u003e Result\u003cusize\u003e. Steps: 1) Try loading existing index 2) If fails, scan *.txt content files 3) Rebuild ClipEntry for each content file 4) Deduplicate by hash 5) Sort by timestamp 6) Save recovered index. Returns count of recovered entries.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:31:41.935730409-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:31:41.935730409-05:00","dependencies":[{"issue_id":"clipboard-8u5.6","depends_on_id":"clipboard-8u5","type":"parent-child","created_at":"2026-01-13T12:31:41.937152947-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-8u5.6","depends_on_id":"clipboard-8u5.1","type":"blocks","created_at":"2026-01-13T12:32:01.795095685-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-8u5.7","title":"[#3] Add Recover CLI command","description":"Add Commands::Recover variant. Handler calls storage.attempt_recovery() and reports recovered entry count. On error, advise user to manually delete ~/.local/share/clipd/index.json as last resort.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:31:43.225584801-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:31:43.225584801-05:00","dependencies":[{"issue_id":"clipboard-8u5.7","depends_on_id":"clipboard-8u5","type":"parent-child","created_at":"2026-01-13T12:31:43.231039534-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-8u5.7","depends_on_id":"clipboard-8u5.6","type":"blocks","created_at":"2026-01-13T12:32:01.834610355-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-8u5.8","title":"[#3] Write unit tests for atomic_write()","description":"Write tests: test_atomic_write_creates_file(), test_atomic_write_no_temp_file_remains(), test_atomic_write_overwrites_existing(). Verify basic functionality and that no .tmp files remain after success.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:31:45.306493891-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:31:45.306493891-05:00","dependencies":[{"issue_id":"clipboard-8u5.8","depends_on_id":"clipboard-8u5","type":"parent-child","created_at":"2026-01-13T12:31:45.315766889-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-8u5.8","depends_on_id":"clipboard-8u5.1","type":"blocks","created_at":"2026-01-13T12:32:01.870731794-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-8u5.9","title":"[#3] Write unit tests for temp file cleanup","description":"Write test_cleanup_orphaned_temp_files(): create orphaned .tmp files, then Storage::new() and verify they're cleaned up. Simulates recovery from interrupted operations.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:31:47.386617306-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:31:47.386617306-05:00","dependencies":[{"issue_id":"clipboard-8u5.9","depends_on_id":"clipboard-8u5","type":"parent-child","created_at":"2026-01-13T12:31:47.388436265-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-8u5.9","depends_on_id":"clipboard-8u5.4","type":"blocks","created_at":"2026-01-13T12:32:01.905323625-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-b6y","title":"Improvement #2: Pinned/Favorites System","description":"Add ability to pin entries to protect them from automatic pruning. Users need to keep frequently-used text permanently: email signatures, code snippets, template responses. Currently no way to prevent important entries from being pruned when history exceeds limit. Solution: pinned boolean field with separate limit (MAX_PINNED=25), star indicator, 'p' keybinding to toggle. Pinned entries shown at top of list.","status":"open","priority":1,"issue_type":"feature","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:32:16.057451575-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:32:16.057451575-05:00","dependencies":[{"issue_id":"clipboard-b6y","depends_on_id":"clipboard-0nf","type":"parent-child","created_at":"2026-01-13T12:32:52.56484425-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-b6y","depends_on_id":"clipboard-8u5","type":"blocks","created_at":"2026-01-13T12:32:52.83749412-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-b6y","depends_on_id":"clipboard-tsd","type":"blocks","created_at":"2026-01-13T13:31:09.695561262-05:00","created_by":"solsystemlabs"}],"comments":[{"id":4,"issue_id":"clipboard-b6y","author":"solsystemlabs","text":"# Improvement #2: Pinned/Favorites System - Detailed Documentation\n\n## Problem Statement\n\nClipStack enforces a maximum of 100 entries. Older entries are automatically pruned when this limit is reached. This creates a problem for frequently-used text that users want to keep permanently:\n\n- Email signatures\n- Code snippets (import statements, boilerplate)\n- Template responses\n- API keys/tokens (though these should arguably be in a password manager)\n\nUsers currently have NO way to prevent important entries from being pruned. They must re-copy these items periodically or use a separate tool - unacceptable UX.\n\n## Solution Design\n\nAdd a \"pin\" capability that:\n\n1. **Marks entries as protected** from automatic pruning\n2. **Shows pinned entries prominently** (top of list with `★` indicator)\n3. **Limits pinned entries** to prevent abuse (MAX_PINNED = 25)\n4. **Persists pin status** in storage index (with #[serde(default)] for backwards compat)\n\n## User Experience\n\n### Keybindings\n- `p` in Normal mode: Toggle pin status of selected entry\n- Pinned entries show `★` prefix in list\n- Status bar shows confirmation: \"Pinned\" / \"Unpinned\"\n\n### Visual Design\n```\n┌─History (5/105) - 3 pinned────────────────────┐\n│\u003e ★ 2d ago [   45B] My email signature...      │ ← Pinned (at top)\n│  ★ 5d ago [  128B] import { useState }...     │ ← Pinned\n│  ★ 1w ago [   32B] const API_BASE = ...       │ ← Pinned\n│  ──────────────────────────────────────────── │ ← Visual separator\n│  10s [  1.2KB] function handleClick()...      │ ← Regular entry\n└───────────────────────────────────────────────┘\n[NORMAL] p:Pin  j/k:Nav  /:Search  Enter:Paste  d:Delete\n```\n\n## Implementation Requirements\n\n### Constants\n```rust\nconst MAX_PINNED: usize = 25;\n```\n\n### ClipEntry Changes\n```rust\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct ClipEntry {\n    pub id: String,\n    pub timestamp: i64,\n    pub size: usize,\n    pub preview: String,\n    pub hash: String,\n    #[serde(default)]  // Backwards compatible!\n    pub pinned: bool,\n}\n```\n\n### Storage Methods\n```rust\npub fn toggle_pin(\u0026self, id: \u0026str) -\u003e Result\u003cbool\u003e;\npub fn set_pinned(\u0026self, id: \u0026str, pinned: bool) -\u003e Result\u003c()\u003e;\npub fn pinned_count(\u0026self) -\u003e Result\u003cusize\u003e;\n```\n\n### Pruning Logic Changes\n```rust\n// In prune_entries(): skip pinned entries\n// In save_entry(): count only unpinned entries against limit\n// When duplicate found: preserve pin status of existing entry\n```\n\n### DeletedEntry Changes (for undo)\n```rust\npub struct DeletedEntry {\n    pub entry: ClipEntry,\n    pub content: String,\n    pub pinned: bool,  // NEW: preserve pin state for undo\n}\n```\n\n### Picker Changes\n- `toggle_pin_selected()` method\n- `sort_entries_by_pin()` - pinned first, then by timestamp\n- Handle pin state in delete/undo cycle\n- Render `★` indicator\n- Update title to show pinned count\n\n## Testing Requirements (TDD)\n\n1. `test_pin_entry()` - Verify toggle works\n2. `test_unpin_entry()` - Verify toggle returns to unpinned\n3. `test_pinned_entries_not_pruned()` - Fill to max+, verify pinned survives\n4. `test_pin_limit()` - Verify MAX_PINNED enforced\n5. `test_backwards_compatibility()` - Old index.json without pinned field loads correctly\n\n## Edge Cases\n\n### Pin + Duplicate Detection\nWhen user copies content that matches an existing pinned entry:\n- Move existing entry to front (update timestamp)\n- Preserve pinned=true status\n- Don't create duplicate\n\n### Pin + Delete\nWhen pinned entry is deleted:\n- Store pinned state in DeletedEntry\n- Undo restores pinned state\n\n### Pin + Reduce Max Entries\nWhen max_entries is reduced:\n- Only prune unpinned entries\n- Pinned entries survive regardless\n\n## Design Decision: Why 25 Max Pinned?\n\n- Prevents users from pinning everything (defeating the purpose)\n- 25 is enough for common use cases (signatures, snippets, templates)\n- Total can be: 25 pinned + 100 unpinned = 125 entries\n- Can be adjusted later if users request more\n\n## Success Criteria\n\n- [ ] `p` key toggles pin status with visual feedback\n- [ ] Pinned entries show `★` indicator\n- [ ] Pinned entries appear at top of list\n- [ ] Pinned entries survive pruning\n- [ ] Maximum 25 pinned entries enforced\n- [ ] `stats` command shows pinned count\n- [ ] Backwards compatible with existing storage\n\n## Files to Modify\n\n| File | Changes |\n|------|---------|\n| src/storage.rs | pinned field, toggle_pin(), set_pinned(), pinned_count(), pruning logic |\n| src/picker.rs | toggle_pin_selected(), sort_by_pin(), render star indicator, update title |\n| src/main.rs | Update stats command for pinned count |\n\n## Dependencies\n\n- **Depends on**: Improvement #5 (Storage::new signature)\n- **Depends on**: Improvement #3 (for atomic saves of pin state changes)\n","created_at":"2026-01-13T17:32:52Z"}]}
{"id":"clipboard-b6y.1","title":"[#2] Add pinned field to ClipEntry with serde default","description":"Add #[serde(default)] pub pinned: bool to ClipEntry struct. The serde(default) attribute ensures backwards compatibility - existing index.json files without this field will load with pinned=false.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:33:09.488583243-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:33:09.488583243-05:00","dependencies":[{"issue_id":"clipboard-b6y.1","depends_on_id":"clipboard-b6y","type":"parent-child","created_at":"2026-01-13T12:33:09.490285645-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-b6y.10","title":"[#2] Add sort_entries_by_pin() to Picker","description":"Add method to sort entries: pinned first (by timestamp desc), then unpinned (by timestamp desc). Call after toggle_pin and on initial load. Preserve current selection by ID.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:34:36.79995594-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:34:36.79995594-05:00","dependencies":[{"issue_id":"clipboard-b6y.10","depends_on_id":"clipboard-b6y","type":"parent-child","created_at":"2026-01-13T12:34:36.801729696-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-b6y.10","depends_on_id":"clipboard-b6y.1","type":"blocks","created_at":"2026-01-13T12:35:07.328074116-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-b6y.11","title":"[#2] Update delete_selected() to track pin state","description":"When creating DeletedEntry in delete_selected(), include entry.pinned value. This preserves pin state for potential undo operation.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:34:37.149045184-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:34:37.149045184-05:00","dependencies":[{"issue_id":"clipboard-b6y.11","depends_on_id":"clipboard-b6y","type":"parent-child","created_at":"2026-01-13T12:34:37.150483021-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-b6y.11","depends_on_id":"clipboard-b6y.8","type":"blocks","created_at":"2026-01-13T12:35:07.36351568-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-b6y.12","title":"[#2] Update undo_delete() to restore pin state","description":"After recreating entry from DeletedEntry, call storage.set_pinned(id, deleted.pinned) to restore original pin state. User shouldn't lose pin decision due to accidental delete/undo.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:34:37.484839248-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:34:37.484839248-05:00","dependencies":[{"issue_id":"clipboard-b6y.12","depends_on_id":"clipboard-b6y","type":"parent-child","created_at":"2026-01-13T12:34:37.486302583-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-b6y.12","depends_on_id":"clipboard-b6y.4","type":"blocks","created_at":"2026-01-13T12:35:07.399105441-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-b6y.13","title":"[#2] Add 'p' keybinding handler in handle_normal_mode()","description":"Add KeyCode::Char('p') case to handle_normal_mode() that calls self.toggle_pin_selected(). Return Ok(None) to continue event loop.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:34:37.868436169-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:34:37.868436169-05:00","dependencies":[{"issue_id":"clipboard-b6y.13","depends_on_id":"clipboard-b6y","type":"parent-child","created_at":"2026-01-13T12:34:37.870038704-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-b6y.13","depends_on_id":"clipboard-b6y.9","type":"blocks","created_at":"2026-01-13T12:35:07.435569005-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-b6y.14","title":"[#2] Update render_list() with pin indicator (★)","description":"In render_list(), add pin indicator span: if entry.pinned then '★ ' else '  '. Use Color::Yellow for star. Ensures visual alignment for all entries.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:34:39.215330349-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:34:39.215330349-05:00","dependencies":[{"issue_id":"clipboard-b6y.14","depends_on_id":"clipboard-b6y","type":"parent-child","created_at":"2026-01-13T12:34:39.220632489-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-b6y.14","depends_on_id":"clipboard-b6y.1","type":"blocks","created_at":"2026-01-13T12:35:07.471388235-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-b6y.15","title":"[#2] Update render_list() title to show pinned count","description":"Update list title format: 'History (filtered/total) - N pinned'. Only show pinned count if \u003e0. Gives users visibility into their pinned items.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:34:41.32024288-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:34:41.32024288-05:00","dependencies":[{"issue_id":"clipboard-b6y.15","depends_on_id":"clipboard-b6y","type":"parent-child","created_at":"2026-01-13T12:34:41.322039057-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-b6y.16","title":"[#2] Update Stats command to show pinned count","description":"In Stats handler, add line: Pinned: {} (not counted against limit). Clarifies that pinned entries don't count towards max_entries limit.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:34:45.36004701-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:34:45.36004701-05:00","dependencies":[{"issue_id":"clipboard-b6y.16","depends_on_id":"clipboard-b6y","type":"parent-child","created_at":"2026-01-13T12:34:45.361556992-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-b6y.17","title":"[#2] Write unit tests for pin operations","description":"Write tests: test_pin_entry(), test_unpin_entry(), test_pinned_entries_not_pruned() (fill to max+, verify pinned survives), test_pin_limit() (verify MAX_PINNED enforced, error on exceed).","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:34:47.469907715-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:34:47.469907715-05:00","dependencies":[{"issue_id":"clipboard-b6y.17","depends_on_id":"clipboard-b6y","type":"parent-child","created_at":"2026-01-13T12:34:47.471374307-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-b6y.17","depends_on_id":"clipboard-b6y.3","type":"blocks","created_at":"2026-01-13T12:35:07.50637028-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-b6y.17","depends_on_id":"clipboard-b6y.1","type":"blocks","created_at":"2026-01-13T14:00:50.707405359-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-b6y.18","title":"[#2] Write backwards compatibility test for pinned field","description":"Write test_backwards_compatibility(): create JSON without pinned field, load via Storage, verify pinned defaults to false. Proves old storage format still works.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:34:49.5697848-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:34:49.5697848-05:00","dependencies":[{"issue_id":"clipboard-b6y.18","depends_on_id":"clipboard-b6y","type":"parent-child","created_at":"2026-01-13T12:34:49.571233879-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-b6y.18","depends_on_id":"clipboard-b6y.1","type":"blocks","created_at":"2026-01-13T12:35:07.542786666-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-b6y.19","title":"[#2] Update render_status_line() to show p:Pin in help","description":"Add 'p:Pin' to the help text in status line. Users need to discover this feature.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:34:55.930935923-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:34:55.930935923-05:00","dependencies":[{"issue_id":"clipboard-b6y.19","depends_on_id":"clipboard-b6y","type":"parent-child","created_at":"2026-01-13T12:34:55.932524923-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-b6y.2","title":"[#2] Add MAX_PINNED constant (25)","description":"Add const MAX_PINNED: usize = 25 to storage.rs. This limits pinned entries to prevent users from pinning everything (which defeats the purpose). 25 is enough for common use cases.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:33:09.794749271-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:33:09.794749271-05:00","dependencies":[{"issue_id":"clipboard-b6y.2","depends_on_id":"clipboard-b6y","type":"parent-child","created_at":"2026-01-13T12:33:09.796384627-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-b6y.20","title":"[#2] Write E2E test script for pinned entries","description":"Create comprehensive E2E test script (tests/e2e/test_pinned_entries.sh) that verifies pinned/favorites functionality. Tests:\n1. Pin toggle works (p key in picker)\n2. Pinned entries show ★ indicator\n3. Pinned entries appear at top of list (before unpinned)\n4. Pinned entries survive pruning (fill to max+10, verify pinned survive)\n5. Maximum 25 pinned entries enforced (try to pin 26th)\n6. Stats command shows pinned count correctly\n7. Backwards compatibility (load old index.json without pinned field)\n8. Pin state survives delete+undo cycle\n\nLOGGING REQUIREMENTS:\n- Use colored output: GREEN=pass, RED=fail, YELLOW=info\n- Each test prints: [TEST N] Description... followed by result\n- For pin operations, show: \"Entry X: pinned=true/false\"\n- For list display, show: \"Entry order: [★entry1, ★entry2, entry3, ...]\"\n- For pruning tests, show: \"Before: N entries (P pinned), After: M entries (P pinned)\"\n- Print summary at end: \"X/Y tests passed\"\n- Exit code: 0 if all pass, 1 if any fail\n\nCLEANUP: Create temp CLIPSTACK_DATA_DIR per test, remove after each test\n\nExample output format:\n[TEST 4] Pinned entries survive pruning...\n  Creating 3 pinned + 100 unpinned entries (103 total, limit 100)...\n  Before pruning: 103 entries (3 pinned)\n  Running daemon to trigger pruning...\n  After pruning: 100 entries (3 pinned)\n  Pinned entries preserved: [id1, id2, id3]\n  ✓ PASS","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T13:29:49.297447716-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T14:06:52.77174998-05:00","dependencies":[{"issue_id":"clipboard-b6y.20","depends_on_id":"clipboard-b6y","type":"parent-child","created_at":"2026-01-13T13:29:49.300320019-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-b6y.20","depends_on_id":"clipboard-b6y.18","type":"blocks","created_at":"2026-01-13T13:30:09.856220413-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-b6y.3","title":"[#2] Implement toggle_pin() method","description":"Add pub fn toggle_pin(\u0026self, id: \u0026str) -\u003e Result\u003cbool\u003e to Storage. Returns new pin state. Must check MAX_PINNED limit when pinning. Save index after toggle (uses atomic write).","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:33:10.112748944-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:33:10.112748944-05:00","dependencies":[{"issue_id":"clipboard-b6y.3","depends_on_id":"clipboard-b6y","type":"parent-child","created_at":"2026-01-13T12:33:10.114376576-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-b6y.3","depends_on_id":"clipboard-b6y.1","type":"blocks","created_at":"2026-01-13T12:35:07.006472648-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-b6y.3","depends_on_id":"clipboard-b6y.2","type":"blocks","created_at":"2026-01-13T12:35:07.043639647-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-b6y.4","title":"[#2] Implement set_pinned() method","description":"Add pub fn set_pinned(\u0026self, id: \u0026str, pinned: bool) -\u003e Result\u003c()\u003e to Storage. Direct setter for pin state. Check MAX_PINNED when setting to true. Used by undo to restore exact state.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:34:05.69627743-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:34:05.69627743-05:00","dependencies":[{"issue_id":"clipboard-b6y.4","depends_on_id":"clipboard-b6y","type":"parent-child","created_at":"2026-01-13T12:34:05.697785429-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-b6y.4","depends_on_id":"clipboard-b6y.1","type":"blocks","created_at":"2026-01-13T12:35:07.079517868-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-b6y.5","title":"[#2] Implement pinned_count() method","description":"Add pub fn pinned_count(\u0026self) -\u003e Result\u003cusize\u003e to Storage. Returns count of entries where pinned=true. Used by toggle_pin to check limit and by stats command for display.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:34:06.069656839-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:34:06.069656839-05:00","dependencies":[{"issue_id":"clipboard-b6y.5","depends_on_id":"clipboard-b6y","type":"parent-child","created_at":"2026-01-13T12:34:06.071440502-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-b6y.5","depends_on_id":"clipboard-b6y.1","type":"blocks","created_at":"2026-01-13T12:35:07.113991593-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-b6y.6","title":"[#2] Update prune_entries() to skip pinned entries","description":"Modify prune logic: when counting entries against max_entries, only count unpinned entries. When removing oldest, use rposition to find oldest UNPINNED entry. Pinned entries are exempt from pruning.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:34:06.39750453-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:34:06.39750453-05:00","dependencies":[{"issue_id":"clipboard-b6y.6","depends_on_id":"clipboard-b6y","type":"parent-child","created_at":"2026-01-13T12:34:06.399104029-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-b6y.6","depends_on_id":"clipboard-b6y.1","type":"blocks","created_at":"2026-01-13T12:35:07.148589099-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-b6y.7","title":"[#2] Update save_entry() duplicate handling for pin preservation","description":"When save_entry detects duplicate by hash: if existing entry is pinned, preserve pin status when moving to front. If unpinned, keep unpinned. Never auto-unpin on re-copy.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:34:06.729756151-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:34:06.729756151-05:00","dependencies":[{"issue_id":"clipboard-b6y.7","depends_on_id":"clipboard-b6y","type":"parent-child","created_at":"2026-01-13T12:34:06.731319834-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-b6y.7","depends_on_id":"clipboard-b6y.1","type":"blocks","created_at":"2026-01-13T12:35:07.184488789-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-b6y.8","title":"[#2] Update DeletedEntry to preserve pin state","description":"Add pinned: bool field to DeletedEntry struct. When deleting entry, store its pin state. When undoing, restore the exact pin state - don't lose user's pin decision.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:34:08.039608452-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:34:08.039608452-05:00","dependencies":[{"issue_id":"clipboard-b6y.8","depends_on_id":"clipboard-b6y","type":"parent-child","created_at":"2026-01-13T12:34:08.045188671-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-b6y.8","depends_on_id":"clipboard-b6y.1","type":"blocks","created_at":"2026-01-13T12:35:07.219409741-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-b6y.9","title":"[#2] Add toggle_pin_selected() to Picker","description":"Add method to toggle pin on currently selected entry. Call storage.toggle_pin(id), update local entries state, re-sort list, set status message 'Pinned'/'Unpinned'. Handle errors gracefully (show in status).","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:34:36.468148888-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:34:36.468148888-05:00","dependencies":[{"issue_id":"clipboard-b6y.9","depends_on_id":"clipboard-b6y","type":"parent-child","created_at":"2026-01-13T12:34:36.469606913-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-b6y.9","depends_on_id":"clipboard-b6y.3","type":"blocks","created_at":"2026-01-13T12:35:07.254170091-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-b6y.9","depends_on_id":"clipboard-b6y.10","type":"blocks","created_at":"2026-01-13T12:35:07.290923477-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-pve","title":"Improvement #4: Preview Scrolling with Focus Mode","description":"Preview pane shows fixed view - no way to see beyond ~30 lines without pasting. Tedious workflow: paste, read, undo if wrong, try another. Solution: add focus mode (Tab toggles between list/preview focus), Ctrl+D/U scrolls focused pane. Scroll position indicator shows line range. Visual scroll arrows when content extends beyond view.","status":"open","priority":1,"issue_type":"feature","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:35:25.940879085-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T14:01:11.579085701-05:00","dependencies":[{"issue_id":"clipboard-pve","depends_on_id":"clipboard-0nf","type":"parent-child","created_at":"2026-01-13T12:36:36.827178452-05:00","created_by":"solsystemlabs"}],"comments":[{"id":6,"issue_id":"clipboard-pve","author":"solsystemlabs","text":"# Improvement #4: Preview Scrolling with Focus Mode - Detailed Documentation\n\n## Problem Statement\n\nThe preview pane shows a fixed view of clipboard content. For long entries, users see only the first ~30 lines with a \"[+N lines]\" indicator. There's NO way to view the rest without:\n\n1. Selecting the entry\n2. Pasting somewhere\n3. Reading the pasted content\n4. Deciding if it's the right entry\n5. Undoing the paste if wrong\n6. Trying another entry\n\nThis workflow is **tedious and disruptive**. Users should be able to scroll through content BEFORE committing to a selection.\n\n## Solution Design: Focus Mode + Scrolling\n\n### Focus Mode\n- `Tab` key toggles focus between List and Preview panes\n- Focused pane has highlighted border (Color::Cyan)\n- Unfocused pane has dimmed border (Color::DarkGray)\n\n### Scrolling (in focused pane)\n- `Ctrl+D`: Scroll down half page (~15 lines)\n- `Ctrl+U`: Scroll up half page (~15 lines)\n- `j/k`: Move by 1 line (when preview focused) OR navigate list (when list focused)\n\n### Visual Feedback\n- Scroll position in title: `[lines 45-75/150]`\n- Scroll indicators: `▲` at top, `▼` at bottom when more content exists\n\n## Implementation Requirements\n\n### New Types\n\n```rust\n#[derive(Clone, Copy, PartialEq, Default)]\nenum Focus {\n    #[default]\n    List,\n    Preview,\n}\n```\n\n### New Picker Fields\n\n```rust\npub struct Picker {\n    // ... existing fields ...\n    preview_scroll: usize,  // NEW: scroll offset in lines\n    focus: Focus,           // NEW: which pane has focus\n}\n```\n\n### Key Methods\n\n```rust\n/// Scroll preview by delta lines (positive = down, negative = up)\nfn scroll_preview(\u0026mut self, delta: i32) {\n    if let Some(content) = \u0026self.preview_content {\n        let total_lines = content.lines().count();\n        // Clamp to valid range\n        self.preview_scroll = new_scroll.min(total_lines.saturating_sub(1));\n    }\n}\n\n/// Toggle focus between List and Preview\nfn toggle_focus(\u0026mut self) {\n    self.focus = match self.focus {\n        Focus::List =\u003e Focus::Preview,\n        Focus::Preview =\u003e Focus::List,\n    };\n}\n```\n\n### load_preview() Changes\n\nCRITICAL: Reset scroll to 0 when selection changes!\n\n```rust\nfn load_preview(\u0026mut self) {\n    // ... existing logic ...\n    self.preview_scroll = 0;  // Reset on new selection\n}\n```\n\n### render_preview() Changes\n\n```rust\nfn render_preview(\u0026self, frame: \u0026mut Frame, area: Rect) {\n    // Apply scroll offset\n    let visible_lines: Vec\u003c\u0026str\u003e = lines\n        .iter()\n        .skip(self.preview_scroll)  // Skip scrolled lines\n        .take(visible_height)\n        .collect();\n\n    // Build title with scroll position\n    let title = format!(\n        \"Preview - {} [lines {}-{}/{}]\",\n        metadata, start_line, end_line, total_lines\n    );\n\n    // Focus-aware border style\n    let border_color = if self.focus == Focus::Preview {\n        Color::Cyan\n    } else {\n        Color::DarkGray\n    };\n}\n```\n\n### Key Handler Changes\n\n```rust\nKeyCode::Tab =\u003e {\n    self.toggle_focus();\n}\n\nKeyCode::Char('j') =\u003e {\n    match self.focus {\n        Focus::List =\u003e self.move_selection(1),\n        Focus::Preview =\u003e self.scroll_preview(1),\n    }\n}\n\nKeyCode::Char('d') if key.modifiers.contains(KeyModifiers::CONTROL) =\u003e {\n    match self.focus {\n        Focus::List =\u003e self.move_selection(15),  // Page down list\n        Focus::Preview =\u003e self.scroll_preview(15),  // Scroll preview\n    }\n}\n```\n\n## Design Decision: Tab for Focus Toggle\n\nWhy Tab instead of other keys?\n\n1. **Intuitive**: Tab commonly switches focus in UIs\n2. **Available**: Not used for anything else in picker\n3. **Discoverable**: Users try Tab naturally\n4. **Non-destructive**: Doesn't conflict with typing\n\n## Testing Requirements (TDD)\n\n1. `test_preview_scroll_down()` - Basic scroll works\n2. `test_preview_scroll_clamps_to_content()` - Can't scroll past end\n3. `test_preview_scroll_negative_clamps_to_zero()` - Can't scroll before start\n4. `test_preview_scroll_resets_on_selection_change()` - New selection resets scroll\n5. `test_focus_toggle()` - Tab switches focus correctly\n6. `test_focus_aware_navigation()` - j/k behavior depends on focus\n\n## Visual Mockup\n\n```\n┌─Preview - 2.3KB - 5m ago [lines 45-75/150]────┐  ← Cyan border (focused)\n│    return {                                    │\n│      user: data.user,                          │\n│      token: generateToken(data.user.id),       │\n│      permissions: await getPermissions(        │\n│        data.user.role                          │\n│      ),                                        │\n│    };                                          │\n│  } catch (error) {                             │\n│    logger.error('Auth failed', { error });     │\n│    throw new AuthenticationError(error);       │\n│  }                                             │\n│}                                              ▼│ ← Scroll indicator\n└───────────────────────────────────────────────┘\n[NORMAL] Tab:Focus  Ctrl+D/U:Scroll  j/k:Nav  Enter:Paste\n```\n\n## Success Criteria\n\n- [ ] Tab toggles focus between list and preview\n- [ ] Ctrl+D/U scrolls the focused pane\n- [ ] j/k navigation is focus-aware\n- [ ] Scroll position indicator shows line range\n- [ ] Visual scroll indicators (▲/▼) show when more content exists\n- [ ] Scroll resets when selection changes\n- [ ] Focused pane has distinct border color\n\n## Files to Modify\n\n| File | Changes |\n|------|---------|\n| src/picker.rs | Focus enum, preview_scroll field, scroll_preview(), toggle_focus(), focus-aware key handlers, updated render functions |\n\n## Dependencies\n\n- **Depends on**: Improvement #2 (Pinned system affects entry display)\n- **Can run parallel to**: Improvement #1 (but #1 should be done first as it changes filtered type)\n","created_at":"2026-01-13T17:36:36Z"}]}
{"id":"clipboard-pve.1","title":"[#4] Define Focus enum (List, Preview)","description":"#[derive(Clone, Copy, PartialEq, Default)] enum Focus { #[default] List, Preview }. Tracks which pane has keyboard focus. Default to List for backwards-compatible behavior.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:39:53.010068556-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:39:53.010068556-05:00","dependencies":[{"issue_id":"clipboard-pve.1","depends_on_id":"clipboard-pve","type":"parent-child","created_at":"2026-01-13T12:39:53.011771149-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-pve.10","title":"[#4] Update render_list() with focus-aware border style","description":"List pane border: Color::Cyan when focus==List, Color::DarkGray otherwise. Visual feedback for which pane will respond to navigation.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:40:12.991863442-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:40:12.991863442-05:00","dependencies":[{"issue_id":"clipboard-pve.10","depends_on_id":"clipboard-pve","type":"parent-child","created_at":"2026-01-13T12:40:12.993356633-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-pve.10","depends_on_id":"clipboard-pve.3","type":"blocks","created_at":"2026-01-13T12:40:39.199171147-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-pve.11","title":"[#4] Update render_preview() with focus-aware border style","description":"Preview pane border: Color::Cyan when focus==Preview, Color::DarkGray otherwise. Matches list pane focus styling.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:40:15.133606779-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:40:15.133606779-05:00","dependencies":[{"issue_id":"clipboard-pve.11","depends_on_id":"clipboard-pve","type":"parent-child","created_at":"2026-01-13T12:40:15.13534029-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-pve.11","depends_on_id":"clipboard-pve.3","type":"blocks","created_at":"2026-01-13T12:40:39.239481691-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-pve.12","title":"[#4] Add Tab key handler for focus toggle","description":"In handle_normal_mode(): KeyCode::Tab =\u003e self.toggle_focus(). Simple and intuitive keybinding.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:40:17.268838727-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:40:17.268838727-05:00","dependencies":[{"issue_id":"clipboard-pve.12","depends_on_id":"clipboard-pve","type":"parent-child","created_at":"2026-01-13T12:40:17.270522155-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-pve.12","depends_on_id":"clipboard-pve.5","type":"blocks","created_at":"2026-01-13T12:40:39.279794639-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-pve.13","title":"[#4] Update j/k navigation to be focus-aware","description":"j/k handlers: if focus==List then move_selection(), if focus==Preview then scroll_preview(1/-1). Same keys, different targets based on focus.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:40:19.404682525-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:40:19.404682525-05:00","dependencies":[{"issue_id":"clipboard-pve.13","depends_on_id":"clipboard-pve","type":"parent-child","created_at":"2026-01-13T12:40:19.406251768-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-pve.13","depends_on_id":"clipboard-pve.4","type":"blocks","created_at":"2026-01-13T12:40:39.320470426-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-pve.13","depends_on_id":"clipboard-pve.3","type":"blocks","created_at":"2026-01-13T12:40:39.361466632-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-pve.14","title":"[#4] Update Ctrl+D/U to be focus-aware","description":"Ctrl+D/U: if focus==List then page navigation (move_selection(15)), if focus==Preview then scroll_preview(15/-15). Half-page scrolling.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:40:21.573643962-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:40:21.573643962-05:00","dependencies":[{"issue_id":"clipboard-pve.14","depends_on_id":"clipboard-pve","type":"parent-child","created_at":"2026-01-13T12:40:21.575370861-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-pve.14","depends_on_id":"clipboard-pve.4","type":"blocks","created_at":"2026-01-13T12:40:39.402681516-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-pve.14","depends_on_id":"clipboard-pve.3","type":"blocks","created_at":"2026-01-13T12:40:39.445253218-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-pve.15","title":"[#4] Update status line to show focus state","description":"Update help text: 'Tab:Focus Ctrl+D/U:Scroll j/k:Nav'. Shows available commands. Consider showing current focus: '[LIST]' or '[PREVIEW]' mode indicator.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:40:23.724884274-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:40:23.724884274-05:00","dependencies":[{"issue_id":"clipboard-pve.15","depends_on_id":"clipboard-pve","type":"parent-child","created_at":"2026-01-13T12:40:23.726676414-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-pve.16","title":"[#4] Write unit tests for scroll operations","description":"test_preview_scroll_down(), test_preview_scroll_clamps_to_content() (can't scroll past end), test_preview_scroll_negative_clamps_to_zero() (can't scroll before start).","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:40:26.109296601-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:40:26.109296601-05:00","dependencies":[{"issue_id":"clipboard-pve.16","depends_on_id":"clipboard-pve","type":"parent-child","created_at":"2026-01-13T12:40:26.11093794-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-pve.16","depends_on_id":"clipboard-pve.4","type":"blocks","created_at":"2026-01-13T12:40:39.484982765-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-pve.16","depends_on_id":"clipboard-pve.2","type":"blocks","created_at":"2026-01-13T14:00:52.36367847-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-pve.17","title":"[#4] Write unit tests for focus toggle","description":"test_focus_toggle(): verify toggle_focus() switches between List and Preview correctly. test_preview_scroll_resets_on_selection_change(): verify scroll=0 after changing selection.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:40:28.248980317-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:40:28.248980317-05:00","dependencies":[{"issue_id":"clipboard-pve.17","depends_on_id":"clipboard-pve","type":"parent-child","created_at":"2026-01-13T12:40:28.250889166-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-pve.17","depends_on_id":"clipboard-pve.5","type":"blocks","created_at":"2026-01-13T12:40:39.525790298-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-pve.17","depends_on_id":"clipboard-pve.1","type":"blocks","created_at":"2026-01-13T14:01:02.215331854-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-pve.18","title":"[#4] Write E2E test script for preview scrolling","description":"Create comprehensive E2E test script (tests/e2e/test_preview_scrolling.sh) that verifies preview scrolling with focus mode. Tests:\n1. Tab toggles focus between List and Preview panes\n2. Ctrl+D scrolls down half page (~15 lines) in focused pane\n3. Ctrl+U scrolls up half page (~15 lines) in focused pane\n4. j/k navigation respects focus (list nav vs preview scroll)\n5. Scroll position indicator shows correct line range [lines X-Y/Z]\n6. Visual scroll indicators (▲/▼) appear when content extends beyond view\n7. Scroll resets to 0 when selection changes\n8. Focused pane has distinct border color (Cyan vs DarkGray)\n\nLOGGING REQUIREMENTS:\n- Use colored output: GREEN=pass, RED=fail, YELLOW=info\n- Each test prints: [TEST N] Description... followed by result\n- For focus tests, show: \"Focus: List -\u003e Preview -\u003e List\"\n- For scroll tests, show: \"Scroll position: 0 -\u003e 15 -\u003e 30\"\n- For indicator tests, show: \"Title shows: [lines 45-75/150]\"\n- Print summary at end: \"X/Y tests passed\"\n- Exit code: 0 if all pass, 1 if any fail\n\nCLEANUP: Create temp CLIPSTACK_DATA_DIR per test, remove after each test\n\nNOTE: Some tests require simulating keypresses - use expect or similar tool\n\nExample output format:\n[TEST 2] Ctrl+D scrolls preview down...\n  Creating entry with 200 lines...\n  Initial scroll position: 0\n  Sending Ctrl+D...\n  Expected scroll: 15, Got: 15\n  Sending Ctrl+D...\n  Expected scroll: 30, Got: 30\n  ✓ PASS","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T13:30:00.118947023-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T14:07:18.41081527-05:00","dependencies":[{"issue_id":"clipboard-pve.18","depends_on_id":"clipboard-pve","type":"parent-child","created_at":"2026-01-13T13:30:00.120858248-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-pve.18","depends_on_id":"clipboard-pve.17","type":"blocks","created_at":"2026-01-13T13:30:10.578744348-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-pve.2","title":"[#4] Add preview_scroll field to Picker","description":"Add preview_scroll: usize field to Picker struct. Tracks scroll offset in lines. Initialize to 0. Reset when selection changes.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:39:55.312080505-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:39:55.312080505-05:00","dependencies":[{"issue_id":"clipboard-pve.2","depends_on_id":"clipboard-pve","type":"parent-child","created_at":"2026-01-13T12:39:55.313751809-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-pve.3","title":"[#4] Add focus field to Picker","description":"Add focus: Focus field to Picker struct. Initialize with Focus::default() (List). Determines which pane responds to navigation keys.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:39:57.456480778-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:39:57.456480778-05:00","dependencies":[{"issue_id":"clipboard-pve.3","depends_on_id":"clipboard-pve","type":"parent-child","created_at":"2026-01-13T12:39:57.458290882-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-pve.3","depends_on_id":"clipboard-pve.1","type":"blocks","created_at":"2026-01-13T12:40:38.912964591-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-pve.4","title":"[#4] Implement scroll_preview() method","description":"fn scroll_preview(\u0026mut self, delta: i32). Adjusts preview_scroll by delta (+ = down, - = up). Clamps to valid range: 0 to total_lines-1. Handles empty content gracefully.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:39:59.598548565-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:39:59.598548565-05:00","dependencies":[{"issue_id":"clipboard-pve.4","depends_on_id":"clipboard-pve","type":"parent-child","created_at":"2026-01-13T12:39:59.600157052-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-pve.4","depends_on_id":"clipboard-pve.2","type":"blocks","created_at":"2026-01-13T12:40:38.953922234-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-pve.5","title":"[#4] Implement toggle_focus() method","description":"fn toggle_focus(\u0026mut self). Switches focus between Focus::List and Focus::Preview. Simple match expression.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:40:01.770873354-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:40:01.770873354-05:00","dependencies":[{"issue_id":"clipboard-pve.5","depends_on_id":"clipboard-pve","type":"parent-child","created_at":"2026-01-13T12:40:01.772576739-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-pve.5","depends_on_id":"clipboard-pve.1","type":"blocks","created_at":"2026-01-13T12:40:38.994043414-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-pve.6","title":"[#4] Update load_preview() to reset scroll on selection change","description":"CRITICAL: When preview_id changes (new selection), set preview_scroll = 0. User shouldn't see previous entry's scroll position when selecting new entry.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:40:04.17025974-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:40:04.17025974-05:00","dependencies":[{"issue_id":"clipboard-pve.6","depends_on_id":"clipboard-pve","type":"parent-child","created_at":"2026-01-13T12:40:04.171852318-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-pve.6","depends_on_id":"clipboard-pve.2","type":"blocks","created_at":"2026-01-13T12:40:39.034767271-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-pve.7","title":"[#4] Update render_preview() with scroll offset","description":"Apply preview_scroll when building visible lines: .skip(self.preview_scroll).take(visible_height). Content shifts based on scroll position.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:40:06.298968518-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:40:06.298968518-05:00","dependencies":[{"issue_id":"clipboard-pve.7","depends_on_id":"clipboard-pve","type":"parent-child","created_at":"2026-01-13T12:40:06.300513016-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-pve.7","depends_on_id":"clipboard-pve.2","type":"blocks","created_at":"2026-01-13T12:40:39.076802419-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-pve.8","title":"[#4] Add scroll position indicator in preview title","description":"Update preview title format: 'Preview - metadata [lines start-end/total]' when content exceeds visible height. Shows user where they are in document.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:40:08.46784661-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:40:08.46784661-05:00","dependencies":[{"issue_id":"clipboard-pve.8","depends_on_id":"clipboard-pve","type":"parent-child","created_at":"2026-01-13T12:40:08.469605678-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-pve.8","depends_on_id":"clipboard-pve.7","type":"blocks","created_at":"2026-01-13T12:40:39.116930702-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-pve.9","title":"[#4] Add scroll indicators (arrows) in preview pane","description":"Render '▲' at top-right when can_scroll_up, '▼' at bottom-right when can_scroll_down. Color::Yellow. Provides visual affordance for scrolling.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:40:10.718937207-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:40:10.718937207-05:00","dependencies":[{"issue_id":"clipboard-pve.9","depends_on_id":"clipboard-pve","type":"parent-child","created_at":"2026-01-13T12:40:10.723919982-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-pve.9","depends_on_id":"clipboard-pve.7","type":"blocks","created_at":"2026-01-13T12:40:39.157889979-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-tsd","title":"Improvement #5: Configurable Max Entries","description":"Enable user customization of history limit via CLI flag and env var. This MUST be implemented FIRST as it changes the Storage::new() signature that all other code depends on. The current hardcoded MAX_ENTRIES=100 doesn't serve all users: power users want 500+, privacy-conscious want fewer. Implementation adds --max-entries flag, CLIPSTACK_MAX_ENTRIES env var, clamping to 1-10000 range, and automatic pruning when limit is reduced.","status":"open","priority":1,"issue_type":"feature","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:28:52.595506805-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:28:52.595506805-05:00","dependencies":[{"issue_id":"clipboard-tsd","depends_on_id":"clipboard-0nf","type":"parent-child","created_at":"2026-01-13T12:30:09.278506803-05:00","created_by":"solsystemlabs"}],"comments":[{"id":2,"issue_id":"clipboard-tsd","author":"solsystemlabs","text":"# Improvement #5: Configurable Max Entries - Detailed Documentation\n\n## Problem Statement\n\nThe maximum number of stored entries is hardcoded:\n\n```rust\n// storage.rs:8\nconst MAX_ENTRIES: usize = 100;\n```\n\nThis one-size-fits-all default doesn't serve all users:\n- **Power users** may want 500+ entries for deep history across projects\n- **Privacy-conscious users** may want only 10-20 entries\n- **Resource-constrained systems** may need limits to control storage size\n\nCurrently, adjusting this requires modifying source code and recompiling - unacceptable UX.\n\n## Why This Must Be Done First\n\nThis improvement changes the `Storage::new()` signature from:\n```rust\npub fn new(base_dir: PathBuf) -\u003e Result\u003cSelf\u003e\n```\nTo:\n```rust\npub fn new(base_dir: PathBuf, max_entries: usize) -\u003e Result\u003cSelf\u003e\n```\n\nALL call sites must be updated, which affects:\n- main.rs (multiple places)\n- daemon.rs (Daemon::new)\n- picker.rs (tests)\n- storage.rs (tests)\n\nDoing this first prevents merge conflicts and signature mismatches in later improvements.\n\n## Solution Design\n\nConfiguration priority (highest to lowest):\n1. **CLI flag**: `--max-entries N`\n2. **Environment variable**: `CLIPSTACK_MAX_ENTRIES`\n3. **Stored preference**: In index.json (for persistence)\n4. **Default**: 100\n\n## Implementation Requirements\n\n### 1. Storage Struct Changes\n```rust\npub struct Storage {\n    base_dir: PathBuf,\n    max_entries: usize,  // NEW FIELD\n}\n```\n\n### 2. Constants\n```rust\nconst DEFAULT_MAX_ENTRIES: usize = 100;\nconst ABSOLUTE_MAX_ENTRIES: usize = 10000;  // Safety limit\n```\n\n### 3. CLI Flag (clap)\n```rust\n#[arg(long, global = true, value_parser = clap::value_parser!(u32).range(1..=10000))]\nmax_entries: Option\u003cu32\u003e,\n```\n\n### 4. Env Var Support\n```rust\nlet max_entries = cli.max_entries\n    .map(|n| n as usize)\n    .or_else(|| std::env::var(\"CLIPSTACK_MAX_ENTRIES\").ok().and_then(|s| s.parse().ok()))\n    .unwrap_or(100);\n```\n\n### 5. Automatic Pruning\nWhen max_entries is reduced below current entry count, prune oldest unpinned entries immediately.\n\n### 6. Daemon Integration\nDaemon::new() must also accept max_entries parameter.\n\n## Testing Requirements (TDD)\n\n1. `test_custom_max_entries()` - Verify limit is respected\n2. `test_max_entries_clamps_to_range()` - Verify 0 becomes 1, 999999 becomes 10000\n3. `test_reducing_max_entries_prunes_immediately()` - Verify old entries removed\n4. `test_pinned_entries_respect_separate_limit()` - Pinned don't count against max\n\n## Success Criteria\n\n- [ ] `--max-entries N` CLI flag works\n- [ ] `CLIPSTACK_MAX_ENTRIES` environment variable works\n- [ ] Values clamped to 1-10000 range\n- [ ] Reducing max_entries prunes old entries immediately\n- [ ] `stats` command shows current limit\n- [ ] Existing storage remains compatible\n\n## Files to Modify\n\n| File | Changes |\n|------|---------|\n| src/storage.rs | Add max_entries field, update new(), add sync_max_entries() |\n| src/main.rs | Add --max-entries flag, env var parsing, update all Storage::new() calls |\n| src/daemon.rs | Update Daemon::new() to accept max_entries |\n| src/picker.rs | Update test fixtures |\n\n## Dependencies\n\n- **None** - This is a foundation task that must be done first\n- **Blocked by this**: All other improvements (#3, #2, #1, #4)\n","created_at":"2026-01-13T17:29:41Z"}]}
{"id":"clipboard-tsd.1","title":"[#5] Cache max_entries in Storage for CLI/env override","description":"Add max_entries field to Storage struct to cache the configured limit from CLI/env. Note: ClipIndex already has max_entries for persistence - this Storage field is for the runtime override. When Storage is created with a non-default limit, it should use that instead of the index value. This enables daemon and picker to respect CLI flags and env vars.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:30:35.520311628-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T13:30:54.891254435-05:00","dependencies":[{"issue_id":"clipboard-tsd.1","depends_on_id":"clipboard-tsd","type":"parent-child","created_at":"2026-01-13T12:30:35.521735429-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-tsd.10","title":"[#5] Add Storage::max_entries() getter method","description":"Add pub fn max_entries(\u0026self) -\u003e usize { self.max_entries }. This allows stats/status commands to display the configured limit without accessing private fields.","status":"open","priority":3,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:30:53.332678334-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:30:53.332678334-05:00","dependencies":[{"issue_id":"clipboard-tsd.10","depends_on_id":"clipboard-tsd","type":"parent-child","created_at":"2026-01-13T12:30:53.334406944-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-tsd.10","depends_on_id":"clipboard-tsd.1","type":"blocks","created_at":"2026-01-13T12:31:15.30360382-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-tsd.11","title":"[#5] Update Stats command to show configured max","description":"Update stats output to show: Entries: {}/{}. First number is current count, second is max_entries. Gives users visibility into how close they are to the limit.","status":"open","priority":3,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:30:53.80954318-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:30:53.80954318-05:00","dependencies":[{"issue_id":"clipboard-tsd.11","depends_on_id":"clipboard-tsd","type":"parent-child","created_at":"2026-01-13T12:30:53.811395752-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-tsd.12","title":"[#5] Update Status command to show configuration source","description":"Add Configuration section showing max_entries and whether it came from CLI, env var, or default. Helps users understand and debug their configuration.","status":"open","priority":3,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:30:54.097294604-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:30:54.097294604-05:00","dependencies":[{"issue_id":"clipboard-tsd.12","depends_on_id":"clipboard-tsd","type":"parent-child","created_at":"2026-01-13T12:30:54.098794096-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-tsd.13","title":"[#5] Update test fixtures to use new Storage::new() signature","description":"All tests using test_storage() helper or direct Storage::new() calls must be updated. Use DEFAULT_MAX_ENTRIES or a custom value as appropriate for each test.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:30:54.391610034-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:30:54.391610034-05:00","dependencies":[{"issue_id":"clipboard-tsd.13","depends_on_id":"clipboard-tsd","type":"parent-child","created_at":"2026-01-13T12:30:54.392996234-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-tsd.13","depends_on_id":"clipboard-tsd.3","type":"blocks","created_at":"2026-01-13T12:31:15.337444903-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-tsd.14","title":"[#5] Write unit tests for configurable max entries","description":"Write tests: test_custom_max_entries(), test_max_entries_clamps_to_range() (0→1, 999999→10000), test_reducing_max_entries_prunes_immediately(), test_pinned_entries_respect_separate_limit(). See IMPLEMENTATION_SPEC.md for code.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:30:54.706420378-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:30:54.706420378-05:00","dependencies":[{"issue_id":"clipboard-tsd.14","depends_on_id":"clipboard-tsd","type":"parent-child","created_at":"2026-01-13T12:30:54.708035766-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-tsd.14","depends_on_id":"clipboard-tsd.13","type":"blocks","created_at":"2026-01-13T12:31:15.372187341-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-tsd.15","title":"[#5] Write E2E test script for configurable max entries","description":"Create comprehensive E2E test script (tests/e2e/test_configurable_max.sh) that verifies configurable max entries via CLI. Tests:\n1. Default limit works (100 entries) - add 101 entries, verify oldest pruned\n2. --max-entries flag respected for daemon/pick/stats commands\n3. CLIPSTACK_MAX_ENTRIES env var works (test precedence: CLI \u003e env \u003e default)\n4. Reducing limit prunes old entries immediately (set 50, verify only 50 remain)\n5. Increasing limit allows more entries (set 200, verify 200 can be stored)\n6. Invalid values clamped to 1-10000 range (test 0, -1, 99999)\n\nLOGGING REQUIREMENTS:\n- Use colored output: GREEN=pass, RED=fail, YELLOW=info\n- Each test prints: [TEST N] Description... followed by result\n- Show expected vs actual values on failure\n- Print summary at end: \"X/Y tests passed\"\n- Exit code: 0 if all pass, 1 if any fail\n\nCLEANUP: Create temp dir per test, remove after each test\n\nExample output format:\n[TEST 1] Default limit (100 entries)...\n  Creating 101 test entries...\n  Verifying pruning...\n  Expected: 100 entries, Got: 100 entries\n  ✓ PASS\n\n[TEST 2] CLI flag --max-entries=50...\n  ...","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T13:29:39.084963011-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T14:02:57.155325182-05:00","dependencies":[{"issue_id":"clipboard-tsd.15","depends_on_id":"clipboard-tsd","type":"parent-child","created_at":"2026-01-13T13:29:39.086863876-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-tsd.15","depends_on_id":"clipboard-tsd.14","type":"blocks","created_at":"2026-01-13T13:30:09.12170531-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-tsd.2","title":"[#5] Define constants DEFAULT_MAX_ENTRIES and ABSOLUTE_MAX_ENTRIES","description":"Add const DEFAULT_MAX_ENTRIES: usize = 100 and const ABSOLUTE_MAX_ENTRIES: usize = 10000 to storage.rs. The absolute max is a safety limit to prevent users from accidentally setting an unreasonably high value.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:30:35.82310521-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:30:35.82310521-05:00","dependencies":[{"issue_id":"clipboard-tsd.2","depends_on_id":"clipboard-tsd","type":"parent-child","created_at":"2026-01-13T12:30:35.824715148-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-tsd.3","title":"[#5] Update Storage::new() signature to accept max_entries parameter","description":"Change signature from new(base_dir: PathBuf) -\u003e Result\u003cSelf\u003e to new(base_dir: PathBuf, max_entries: usize) -\u003e Result\u003cSelf\u003e. Add clamping logic: max_entries.clamp(1, ABSOLUTE_MAX_ENTRIES). This is the core signature change that affects all call sites.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:30:36.126611003-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:30:36.126611003-05:00","dependencies":[{"issue_id":"clipboard-tsd.3","depends_on_id":"clipboard-tsd","type":"parent-child","created_at":"2026-01-13T12:30:36.128025105-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-tsd.3","depends_on_id":"clipboard-tsd.1","type":"blocks","created_at":"2026-01-13T12:31:15.09821814-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-tsd.3","depends_on_id":"clipboard-tsd.2","type":"blocks","created_at":"2026-01-13T12:31:15.134525161-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-tsd.4","title":"[#5] Add Storage::with_defaults() convenience constructor","description":"Add a convenience method that uses DEFAULT_MAX_ENTRIES: pub fn with_defaults(base_dir: PathBuf) -\u003e Result\u003cSelf\u003e { Self::new(base_dir, DEFAULT_MAX_ENTRIES) }. This simplifies call sites that don't need custom limits.","status":"open","priority":3,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:30:36.441947271-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:30:36.441947271-05:00","dependencies":[{"issue_id":"clipboard-tsd.4","depends_on_id":"clipboard-tsd","type":"parent-child","created_at":"2026-01-13T12:30:36.443586103-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-tsd.4","depends_on_id":"clipboard-tsd.3","type":"blocks","created_at":"2026-01-13T12:31:15.168006622-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-tsd.5","title":"[#5] Implement sync_max_entries() for immediate pruning on reduction","description":"Add method to check if current entry count exceeds new max_entries and prune oldest unpinned entries immediately. Call this in Storage::new() after loading index. This ensures reducing max_entries has immediate effect.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:30:36.771090496-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:30:36.771090496-05:00","dependencies":[{"issue_id":"clipboard-tsd.5","depends_on_id":"clipboard-tsd","type":"parent-child","created_at":"2026-01-13T12:30:36.772672011-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-tsd.5","depends_on_id":"clipboard-tsd.3","type":"blocks","created_at":"2026-01-13T12:31:15.200479709-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-tsd.6","title":"[#5] Add --max-entries CLI flag with clap","description":"Add to Cli struct: #[arg(long, global = true, value_parser = clap::value_parser!(u32).range(1..=10000))] max_entries: Option\u003cu32\u003e. The global=true makes it available for all subcommands. Value parser handles range validation.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:30:37.072965342-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:30:37.072965342-05:00","dependencies":[{"issue_id":"clipboard-tsd.6","depends_on_id":"clipboard-tsd","type":"parent-child","created_at":"2026-01-13T12:30:37.074544253-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-tsd.7","title":"[#5] Add CLIPSTACK_MAX_ENTRIES env var support","description":"In main(), parse env var as fallback when CLI flag not provided: cli.max_entries.or_else(|| std::env::var(\"CLIPSTACK_MAX_ENTRIES\").ok().and_then(|s| s.parse().ok())).unwrap_or(100). Priority: CLI \u003e env var \u003e default.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:30:37.381081541-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:30:37.381081541-05:00","dependencies":[{"issue_id":"clipboard-tsd.7","depends_on_id":"clipboard-tsd","type":"parent-child","created_at":"2026-01-13T12:30:37.382757142-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-tsd.8","title":"[#5] Update all Storage::new() call sites in main.rs","description":"Find all Storage::new() calls in main.rs and update to pass max_entries parameter. Each subcommand handler must pass the resolved max_entries value from CLI/env/default.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:30:52.696617136-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:30:52.696617136-05:00","dependencies":[{"issue_id":"clipboard-tsd.8","depends_on_id":"clipboard-tsd","type":"parent-child","created_at":"2026-01-13T12:30:52.698259134-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-tsd.8","depends_on_id":"clipboard-tsd.3","type":"blocks","created_at":"2026-01-13T12:31:15.234173657-05:00","created_by":"solsystemlabs"}]}
{"id":"clipboard-tsd.9","title":"[#5] Update Daemon::new() to accept and forward max_entries","description":"Daemon creates Storage internally. Update Daemon::new() signature to accept max_entries and pass it through to Storage::new(). This ensures daemon respects configured limits.","status":"open","priority":2,"issue_type":"task","owner":"me@tayloreernisse.com","created_at":"2026-01-13T12:30:52.996601436-05:00","created_by":"solsystemlabs","updated_at":"2026-01-13T12:30:52.996601436-05:00","dependencies":[{"issue_id":"clipboard-tsd.9","depends_on_id":"clipboard-tsd","type":"parent-child","created_at":"2026-01-13T12:30:52.998056244-05:00","created_by":"solsystemlabs"},{"issue_id":"clipboard-tsd.9","depends_on_id":"clipboard-tsd.3","type":"blocks","created_at":"2026-01-13T12:31:15.269344916-05:00","created_by":"solsystemlabs"}]}
